<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    * { box-sizing: border-box; font-family: 'Google Sans', Arial, sans-serif; }
    body { margin: 0; padding: 12px; background: #f8f9fa; }
    h2 { color: #1a73e8; margin: 0 0 12px 0; font-size: 16px; font-weight: 500; }
    .step-container { margin-bottom: 8px; }
    .step-btn {
      display: flex; align-items: center; width: 100%; padding: 14px 12px;
      border: 1px solid #dadce0; border-radius: 8px; font-size: 14px; font-weight: 500;
      cursor: pointer; text-align: left; background: white; color: #202124;
    }
    .step-btn:hover:not(:disabled) { background: #e8f0fe; border-color: #1a73e8; }
    .step-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .step-btn.running { background: #e8f0fe; border-color: #1a73e8; }
    .step-btn.done { background: #e6f4ea; border-color: #34a853; }
    .step-num {
      width: 24px; height: 24px; background: #1a73e8; color: white; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; font-weight: 600; margin-right: 12px;
    }
    .step-btn.done .step-num { background: #34a853; }
    .step-btn.done .step-num::after { content: '‚úì'; }
    .step-btn.done .step-num span { display: none; }
    .step-text { flex: 1; }
    .step-subtitle { font-size: 11px; color: #5f6368; margin-top: 2px; }
    .divider { height: 1px; background: #dadce0; margin: 16px 0; }
    .section-title { font-size: 11px; font-weight: 600; color: #5f6368; text-transform: uppercase; margin-bottom: 8px; }
    .quick-btn {
      display: inline-block; padding: 8px 12px; margin: 4px 4px 4px 0;
      border: 1px solid #dadce0; border-radius: 16px; font-size: 12px;
      cursor: pointer; background: white; color: #5f6368;
    }
    .quick-btn:hover:not(:disabled) { background: #f1f3f4; }
    .quick-btn:disabled { opacity: 0.5; }
    .status-bar {
      position: fixed; bottom: 0; left: 0; right: 0; padding: 10px 12px;
      background: #e8f0fe; color: #1a73e8; font-size: 12px; display: none;
    }
    .status-bar.show { display: block; }
    .status-bar.error { background: #fce8e6; color: #c5221f; }
    .status-bar.success { background: #e6f4ea; color: #137333; }
    .reset-link { display: block; text-align: center; margin-top: 12px; font-size: 11px; color: #5f6368; cursor: pointer; }
  </style>
</head>
<body>
  <h2>üß§ Workflow Steps</h2>

  <div class="step-container">
    <button class="step-btn" id="step1" onclick="runStep(1, 'generateAllReports')">
      <span class="step-num"><span>1</span></span>
      <div class="step-text">Generate All Reports<div class="step-subtitle">Swaps, Purchase Needs, Reclaims</div></div>
    </button>
  </div>

  <div class="step-container">
    <button class="step-btn" id="step2" onclick="runStep(2, 'generateSmartSchedule')">
      <span class="step-num"><span>2</span></span>
      <div class="step-text">Create Smart Schedule<div class="step-subtitle">To-Do List by location</div></div>
    </button>
  </div>

  <div class="step-container">
    <button class="step-btn" id="step3" onclick="runStep(3, 'saveHistory')">
      <span class="step-num"><span>3</span></span>
      <div class="step-text">Save to History<div class="step-subtitle">Record current state</div></div>
    </button>
  </div>

  <div class="step-container">
    <button class="step-btn" id="step4" onclick="runStep(4, 'createBackupSnapshot')">
      <span class="step-num"><span>4</span></span>
      <div class="step-text">Create Backup<div class="step-subtitle">Save to Drive</div></div>
    </button>
  </div>

  <div class="reset-link" onclick="resetSteps()">‚Ü∫ Reset workflow</div>

  <div class="divider"></div>
  <div class="section-title">Quick Actions</div>
  <div>
    <button class="quick-btn" onclick="runQuick('generateGloveSwaps', 'Generate Glove Swaps', 'Updating Glove Swaps report...')">üß§ Gloves</button>
    <button class="quick-btn" onclick="runQuick('generateSleeveSwaps', 'Generate Sleeve Swaps', 'Updating Sleeve Swaps report...')">üí™ Sleeves</button>
    <button class="quick-btn" onclick="runQuick('updatePurchaseNeeds', 'Update Purchase Needs', 'Calculating purchase requirements...')">üõí Purchase</button>
    <button class="quick-btn" onclick="runQuick('showItemHistoryLookup', 'Item History Lookup', 'Opening history lookup dialog...')">üîç Lookup</button>
  </div>

  <div id="statusBar" class="status-bar"></div>

  <script>
    function runStep(n, func) {
      var btn = document.getElementById('step' + n);
      btn.classList.add('running'); btn.disabled = true;
      showStatus('Running Step ' + n + '...');
      google.script.run.withSuccessHandler(function() {
        btn.classList.remove('running'); btn.classList.add('done'); btn.disabled = false;
        showStatus('‚úì Step ' + n + ' complete!', 'success');
        setTimeout(hideStatus, 2000);
      }).withFailureHandler(function(e) {
        btn.classList.remove('running'); btn.disabled = false;
        showStatus('Error: ' + e, 'error');
      })[func]();
    }
    function runQuick(func, title, message) {
      document.querySelectorAll('.quick-btn').forEach(function(b){b.disabled=true;});
      showStatus('‚è≥ ' + message);
      google.script.run.withSuccessHandler(function() {
        document.querySelectorAll('.quick-btn').forEach(function(b){b.disabled=false;});
        showStatus('‚úì ' + title + ' complete!', 'success'); setTimeout(hideStatus, 2000);
      }).withFailureHandler(function(e) {
        document.querySelectorAll('.quick-btn').forEach(function(b){b.disabled=false;});
        showStatus('Error: ' + e, 'error');
      })[func]();
    }
    function resetSteps() {
      for(var i=1;i<=4;i++){var b=document.getElementById('step'+i);b.classList.remove('done','running');b.disabled=false;}
      showStatus('Reset', 'success'); setTimeout(hideStatus, 1500);
    }
    function showStatus(m, t) { var s=document.getElementById('statusBar'); s.textContent=m; s.className='status-bar show '+(t||''); }
    function hideStatus() { document.getElementById('statusBar').className='status-bar'; }
  </script>
</body>
</html>

